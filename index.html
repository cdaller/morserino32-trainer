<!doctype html>
<html lang="en">

<head>
    <title>Morserino CW Trainer</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff"/>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="manifest" href="manifest.webmanifest">
    
    <style>
        .hidden {
            display: none;
        }

        .correct {
            color: black;
            background-color: lightgreen;
        }

        .wrong {
            color: white;
            background-color: red;
        }
        .missing {
            color: black;
            background-color: orange;
        }
        .bd-footer {
            text-align: center;
        }
        .header {
            box-shadow: 0 0.5em 1.5em rgb(0 0 0 / 10%);
            background-color: #EEEEEE;
        }
        .contentContainer {
            padding: 20px;
        }
        contentContainer .row {
            padding: 12px;
        }
        .inputContainer {
            margin-top: 25px;
            background-color: #f9f8f8;
            border: 1px solid #CCCCCC;
            padding: 12px;
        }
        .inputContainer button {
            margin: 5px;
        }
        .savedResultContainer {
            margin-top: 25px;
            background-color: #f9f8f8;
            border: 1px solid #CCCCCC;
            padding: 12px;
        }
        .savedResultContainer button {
            padding: 5px;
            margin-top: 5px;
        }
        .form-group {
            margin-top: 12px;
            margin-bottom: 8px;
        }
        .form-group textarea {
            font-size: 120%;
            padding: 5px;
            text-transform: uppercase;
            width: 100%;
        }
        .result {
            font-family: monospace;
            font-size: 140%;
            text-transform: uppercase;
        }
        .legend {
            font-size: 90%;
            margin-top: 20px;
            opacity: 0.7;
        }
        #receiveText {
            background-color: #e2e3e5;
        }
        #receiveTextEchoTrainer {
            background-color: #e2e3e5;
        }
        #mainTab {
            padding-top: 20px;
        }
        #serialCommunicationDisabledInfo {
            display: none;
        }

    </style>
</head>

<body>
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <div class="shadow-sm p-3 mb-2 bg-light">
        <h1>Morserino32 CW Training</h1>
            <div class="row">
                <div class="col-12 col-md-11">
                    <ul>
                        <li>Compare the characters received from <a href="https://www.morserino.info" target="_blank">Morserino32</a> in "CW Generator" 
                            mode with the decoded text you entered</li>
                        <li>or the text you keyed on the Morserino in "CW Keyer" mode with the text you want to key</li>
                        <li>New: learn abbreviations in "Echo Trainer" mode showing the meaning of the abbreviations you keyed correctly</li>
                    </ul>
                </div>
                <div class="col-12 col-md-1">
                    <button class="btn btn-info float-right" style="margin-top: 4px" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHelp" aria-expanded="false" aria-controls="collapseHelp">
                        Help
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="collapse" id="collapseHelp">
        <div class="card card-body">
            You might need to configure the morserino to send characters via serial line first (see below)! Only Chrome, Edge and Opera are supported at the moment!
            <ul>
                <li>Connect usb cable from Morserino32 to your PC/Mac/Linux machine.</li>
                <li>Use "Connect" button and select serial port of Morserino32</li>
                <li>Start CW-Generator on Morserino</li>
                <li>Type your decoded CW text into the second field.</li>
                <li>Hide received/compared text if you want.</li>
            </ul>
            <p>
            The results can also be saved into the local storage of the browser to show the progress you make and to have some text to encode in cw.
            </p>
            <p>
            For a CW Keyer training copy the text to be keyed into the "Your Input" field and start keying on the Morserino.
            </p>
            <p>
            Configure Morserino to send data via serial cable (by default, the morserino does not send data to the serial connection):
            </p>
            <ul>
                <li>Double click black button on Morserino</li>
                <li>Find "Serial Output"</li>
                <li>Set to "Everything"</li>
            </ul>
            You might to do this for every stored snapshot profile you want to use!
        </div>
    </div>

    <div class="contentContainer">
        <div class="row">
            <div class="col-12 col-md-12">
                Morserino Status:&#160;<span id="statusBar" class="badge bg-danger">Disconnected</span>
                <button id="connectButton" class="btn btn-primary" style="margin-top: 4px" title="Connect to Morserino via USB cable" data-bs-toggle="tooltip">Connect</button>
            </div>
            <div class="col-12 col-md-12">
                <div id="serialCommunicationDisabledInfo" class="alert alert-danger mt-2" >
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                        <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>
                        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z"/>
                      </svg>
                    Your browser does not support communication to Morserino!
                    Please use Chrome, Edge or Opera!
                </div>
            </div>
        </div>

        <ul class="nav nav-tabs" id="mainTab" role="tablist">
            <li class="nav-item" role="presentation">
            <button class="nav-link active" id="cw-generator-tab" data-bs-toggle="tab" data-bs-target="#cw-generator-tab-content" type="button" role="tab" aria-controls="cw-generator-tab-content" aria-selected="true">CW Generator / CW Keyer</button>
            </li>
            <li class="nav-item" role="presentation">
            <button class="nav-link" id="echo-trainer-tab" data-bs-toggle="tab" data-bs-target="#echo-trainer-tab-content" type="button" role="tab" aria-controls="echo-trainer-tab-content" aria-selected="false">Echo Trainer (new!)</button>
            </li>
        </ul>
        <div class="tab-content" id="mainTabContent">
            <!-- start cw generator -->
            <div class="tab-pane fade show active" id="cw-generator-tab-content" role="tabpanel" aria-labelledby="cw-generator-tab">
                <h2>CW Generator / CW Keyer</h2>
                <div class="inputContainer">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" checked id="showReceivedCheckbox">
                        <label class="form-check-label" for="showReceivedCheckbox">Show comparision received/input and received text from Morserino</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" checked id="autoHideCheckbox">
                        <label class="form-check-label" for="autoHideCheckbox">Auto hide during reception (between receiving 'vvv&lt;ka&gt;' and '+')</label>
                    </div>
        
                    <div class="form-group">
                        <div id="morserino_detail" class="collapse show">
                            Received from Morserino:
                            <textarea readonly onfocus="this.blur()" rows="3" cols="80" id="receiveText" spellcheck="false" placeholder="Here the characters received from Morserino are shown."></textarea>
                            <!--<textarea rows="3" cols="80" id="receiveText" spellcheck="false" placeholder="Here the characters received from Morserino are shown."></textarea>-->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        Your Input:<br />
                        <textarea rows="3" cols="80" id="inputText" spellcheck="false" placeholder="Type here the letters you encode from Morserino"></textarea>
                    </div>
        
                    <div>
                        <button id="clearAllButton" class="btn btn-outline-primary" title="Clear text received from Morserino, your input and the comparison result (for CW Generator mode)" data-bs-toggle="tooltip">Clear All</button>
                        <button id="clearReceivedButton" class="btn btn-outline-secondary" title="Clear only text received from Morserino and comparison result (for CW Keyer mode)" data-bs-toggle="tooltip">Clear Received Text and Result</button>
                    </div>
        
                    <div id="resultComparison" class="mt-2 collapse show">
                        <div class="alert alert-secondary">
                            Result comparing Received/Input: <button id="compareTextsButton" style="display:none;">Compare</button>
                            <div id="inputComparator" class="result"></div>
                            <div id="correctPercentage"></div> 
        
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="ignoreWhitespaceCheckbox">
                                <label class="form-check-label" for="ignoreWhitespaceCheckbox">Ignore whitespace during comparison</label>
                            </div>
        
                            <div class="legend">
                                You must have >= 90% to continue with the next letter.
                                <ul>
                                    <li>Green: correct character</li>
                                    <li>Orange: missing character</li>
                                    <li>Red: wrong character</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-primary" id="saveButton" title="Saved results are shown in list below and are only stored in your browser and not sent to anyone!" data-bs-toggle="tooltip">
                            Save Result
                        </button>
                    </div>
                </div>
                <div class="savedResultContainer">
                    <h3>Saved Results</h3>
                    <div id="savedResults"></div>
                </div>
        
                <canvas id="savedResultChart" height="100"></canvas>
            </div> <!-- end cw generator -->

            <!-- start echo trainer -->
            <div class="tab-pane fade" id="echo-trainer-tab-content" role="tabpanel" aria-labelledby="echo-trainer-tab">
                <h2>Echo Trainer</h2>
                <div class="form-group">
                    Received from Morserino:
                    <textarea readonly onfocus="this.blur()" rows="6" cols="80" id="receiveTextEchoTrainer" spellcheck="false" placeholder="Here the characters received from Morserino are shown."></textarea>
                </div>
                <div>
                    <button id="clearEchoTrainerButton" class="btn btn-outline-primary" title="Clear text received from Morserino (for Echo Trainer mode) and abbreviation list." data-bs-toggle="tooltip">Clear</button>
                    <button id="showAllAbbreviationsButton" class="btn btn-outline-primary" title="Show all abbreviations" data-bs-toggle="tooltip">Show All Abbreviations</button>
                </div>

                <table id="abbreviationTable" class="table">
                    <thead>
                        <tr>
                            <th>Abbr.</th>
                            <th>English</th>
                            <th>German</th>
                        </tr>  
                    </thead>
                    <tbody>
                    </tbody>                  
                </table>

            </div> <!-- end echo trainer -->
        </div> <!-- end tab-content -->
    </div>

    <script type="text/javascript" src="bundle.js"></script>
    <!--
        Service worker disabled for the moment, as old bundle.js are used quite often instead of the new ones!
        Further investigation needed on this topic.
    -->
    <script>
        if ('serviceWorker' in navigator) {
            // unregister previously created service worker
            // sw had the effect of serving old javascript files, so unregister it for the moment!
            navigator.serviceWorker.getRegistrations()
            .then(function(registrations) {
                for(let registration of registrations) {
                registration.unregister();
                }
            });

            // register service worker
            // navigator.serviceWorker.register('sw.js')
            //     .then(function () { console.log("Service worker registered"); });
        }
    </script>
</body>

<footer class="bd-footer py-3 mt-2 bg-dark text-white">
    Made with â™¥ by Christof Dallermassl <span style="opacity: 0.75">OE6CHD</span> - <a href="https://github.com/cdaller/morserino32-trainer" target="_blank">GitHub Repo</a>
    - <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Ftegmento.org&count_bg=%2379C83D&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=visits&edge_flat=false"/>
    - V<span id="versionSpan">0.1.0</span>
</footer>

</html>